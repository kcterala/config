# ==============================================================================
# TMUX Configuration - Vesper Theme (Standalone)
# ==============================================================================

# ------------------------------------------------------------------------------
# General Settings
# ------------------------------------------------------------------------------

set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",*:RGB"
set -ag terminal-overrides ",*:Ss=\\E[%p1%d q:Se=\\E[6 q"

# Start windows and panes at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Faster command sequences
set -sg escape-time 0

# Vi mode (for copy mode if needed)
setw -g mode-keys vi

# Disable clipboard integration (prevent macOS permission prompts)
set -g set-clipboard off

# History
set -g history-limit 50000

# Focus events for terminal
set -g focus-events on

# Mouse off - let iTerm2 handle scroll/copy/paste
set -g mouse off

# Allow iTerm2 to access scrollback
set -ga terminal-overrides ',xterm*:smcup@:rmcup@'

# ------------------------------------------------------------------------------
# Prefix Key
# ------------------------------------------------------------------------------

# Change prefix from Ctrl+b to Ctrl+a
unbind C-b
set -g prefix C-a
bind C-a     send-prefix

# ------------------------------------------------------------------------------
# Keybindings
# ------------------------------------------------------------------------------

# Reload config
bind r source-file ~/.tmux.conf \; display "Config reloaded"

# Splits: prefix + | (horizontal) | prefix + - (vertical)
bind \\ split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# New window in current directory
bind c new-window -c "#{pane_current_path}"

# Vim-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Quick actions
bind x kill-pane
bind X kill-window
bind z resize-pane -Z

# Open project as new window (fuzzy finder)
bind o display-popup -E -w 60% -h 40% -S "fg=#282828" -b rounded "~/Developer/config/terminal/tmux-project-window"

# ------------------------------------------------------------------------------
# Vesper Colors
# ------------------------------------------------------------------------------

# Color definitions
vesper_bg="#101010"
vesper_bg_elevated="#1A1A1A"
vesper_bg_selected="#232323"
vesper_fg="#FFFFFF"
vesper_fg_muted="#A0A0A0"
vesper_fg_dim="#5C5C5C"
vesper_accent="#FFC799"
vesper_mint="#99FFE4"
vesper_border="#282828"

# ------------------------------------------------------------------------------
# Status Bar
# ------------------------------------------------------------------------------

set -g status-position bottom
set -g status-style "bg=$vesper_bg fg=$vesper_fg_muted"
set -g status-interval 5

# Left: session name | uptime
set -g status-left-length 50
set -g status-left "#[fg=#FFC799,bold]#S #[fg=#5C5C5C]│ #[fg=#A0A0A0]↑#(uptime | awk -F'up ' '{print $2}' | awk -F', *[0-9]+ user' '{print $1}' | sed 's/ days\\{0,1\\},/d/; s/:/h /; s/ *$/m/; s/  */ /g') #[fg=#5C5C5C]│ "

# Right: keyboard icon appears when prefix pressed | time | date | hostname
set -g status-right-length 50
set -g status-right "#{?client_prefix,#[fg=$vesper_mint]⌨ ,}#[fg=$vesper_fg_muted]%H:%M #[fg=$vesper_fg_dim]│ #[fg=$vesper_fg_muted]%d %b #[fg=$vesper_fg_dim]│ #[fg=$vesper_accent]#H "

# ------------------------------------------------------------------------------
# Window Status (Tab-like)
# ------------------------------------------------------------------------------

# Inactive windows
setw -g window-status-style "fg=#FFFFFF"
setw -g window-status-format "#[fg=#FFFFFF] #I #W#{?#{==:#{pane_current_command},ssh},#[fg=#99FFE4] 󰌘,}#{?window_zoomed_flag,Z,} "

# Active window (orange)
setw -g window-status-current-style "fg=#FFC799,bold"
setw -g window-status-current-format "#[fg=#FFC799,bold] #I #W#{?#{==:#{pane_current_command},ssh},#[fg=#99FFE4] 󰌘,}#{?window_zoomed_flag,Z,} "

# Separator between windows
setw -g window-status-separator "#[fg=#5C5C5C]│"

# Activity alerts
setw -g window-status-activity-style "fg=$vesper_mint,underscore"
setw -g window-status-bell-style "fg=$vesper_mint,blink,bold"

# ------------------------------------------------------------------------------
# Panes
# ------------------------------------------------------------------------------

# Pane borders
set -g pane-border-style "fg=$vesper_border"
set -g pane-active-border-style "fg=$vesper_accent"

# Pane numbers (Ctrl+a q)
set -g display-panes-colour "$vesper_fg_dim"
set -g display-panes-active-colour "$vesper_accent"

# ------------------------------------------------------------------------------
# Messages & Command Prompt
# ------------------------------------------------------------------------------

set -g message-style "bg=$vesper_bg_selected fg=$vesper_fg"
set -g message-command-style "bg=$vesper_bg_selected fg=$vesper_fg"

# ------------------------------------------------------------------------------
# Copy Mode
# ------------------------------------------------------------------------------

setw -g mode-style "bg=$vesper_accent fg=$vesper_bg"
setw -g copy-mode-selection-style "reverse"
setw -g cursor-style bar

# Enter copy mode
bind v copy-mode

# Vi-style copy to macOS clipboard
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"

# ------------------------------------------------------------------------------
# Clock (Ctrl+a t)
# ------------------------------------------------------------------------------

setw -g clock-mode-colour "$vesper_accent"
setw -g clock-mode-style 12

# ------------------------------------------------------------------------------
# Misc
# ------------------------------------------------------------------------------

set -g bell-action none

